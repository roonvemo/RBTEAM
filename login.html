<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Royal Bee</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{--orange:#FF751F;--glass: rgba(255,255,255,0.18);--glass-strong: rgba(255,255,255,0.28);--text:#072022;--muted:#666;--shadow: rgba(0,0,0,0.12);}
*{box-sizing:border-box;}
html,body{height:100%;margin:0;font-family:'Tajawal',sans-serif;background:linear-gradient(135deg,#f6fbff,#e9f6f2);color:var(--text);display:flex;justify-content:center;align-items:center;}
.container{background:var(--glass-strong);backdrop-filter:blur(8px);padding:40px 30px;border-radius:18px;box-shadow:0 8px 30px var(--shadow);max-width:400px;width:100%;text-align:center;}
h2{text-align:center;color:var(--orange);margin-bottom:20px;}
label{display:block;margin:10px 0 6px;font-weight:700;text-align:right;}
input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);background:#fff;margin-bottom:10px;}
.btn{width:100%;padding:12px;background:var(--orange);color:#fff;border:none;border-radius:12px;font-weight:700;cursor:pointer;margin-top:10px;}
.btn:hover{transform:scale(1.03);transition:0.2s;}
.kv{text-align:center;color:var(--muted);font-size:13px;margin-top:12px;}
.logo{width:100px;height:auto;margin-bottom:15px;}
</style>
</head>
<body>

<div class="container">
  <!-- âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„ÙˆØ¬Ùˆ Ù‡Ù†Ø§ -->
  <img src="assets/logo.png" alt="Royal Bee Logo" class="logo">

  <h2 id="formTitle">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
  <form id="loginForm">
    <label for="idNum">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ</label>
    <input type="text" id="idNum" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ" required>

    <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
    <input type="password" id="password" placeholder="********" required>

    <div id="firstTimeFields" style="display:none;">
      <label for="confirmPassword">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
      <input type="password" id="confirmPassword" placeholder="********">
      <label for="upline">Ø§Ø³Ù… Ø§Ù„Ø§Ø¨Ù„Ø§ÙŠÙ†</label>
      <input type="text" id="upline" placeholder="Ø§Ø³Ù… Ø§Ù„Ø§Ø¨Ù„Ø§ÙŠÙ†">
    </div>

    <button type="submit" class="btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
  </form>
  <div class="kv" id="kvMsg">Ø§Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</div>
</div>

<script>
// ---------- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠÙŠÙ† ----------
let users = JSON.parse(localStorage.getItem('users')||'[]');
let adminIds = [];
let userIds = [];

// ---------- ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…ØµØ±Ø­ Ø¨Ù‡Ø§ ----------
fetch('data/authorizedUsers.json')
  .then(res => res.json())
  .then(data => {
    adminIds = data.admins || [];
    userIds = data.users || [];
  })
  .catch(err => console.error('âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„:', err));

const idInput = document.getElementById('idNum');
const firstTimeFields = document.getElementById('firstTimeFields');
const formTitle = document.getElementById('formTitle');
const kvMsg = document.getElementById('kvMsg');

// ---------- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ----------
idInput.addEventListener('input', ()=>{
  const id = idInput.value.trim();
  const user = users.find(u=>u.id===id);
  if(user){
    firstTimeFields.style.display='none';
    formTitle.textContent='ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
    kvMsg.textContent='Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙÙ‚Ø·';
  } else {
    firstTimeFields.style.display='block';
    formTitle.textContent='ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯';
    kvMsg.textContent='Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ';
  }
});

// ---------- Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„" ----------
document.getElementById('loginForm').addEventListener('submit', e=>{
  e.preventDefault();
  const id = idInput.value.trim();
  const password = document.getElementById('password').value.trim();
  const confirmPassword = document.getElementById('confirmPassword').value.trim();
  const upline = document.getElementById('upline').value.trim();

  let user = users.find(u=>u.id===id);

  // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„
  const isAuthorized = adminIds.includes(id) || userIds.includes(id);
  if(!isAuthorized){
    alert('ğŸš« Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ù‡ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„.');
    return;
  }

  if(user){ // Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹
    if(user.password === password){
      alert('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
      localStorage.setItem('currentUser', JSON.stringify(user));
      if(adminIds.includes(id)) window.location.href='admin-dashboard.html';
      else window.location.href='index.html';
    } else {
      alert('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
    }
  } else { // Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
    if(!password || !confirmPassword || !upline){
      alert('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
      return;
    }
    if(password !== confirmPassword){
      alert('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØªØ£ÙƒÙŠØ¯Ù‡Ø§ ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ÙŠÙ†');
      return;
    }

    const isAdmin = adminIds.includes(id);
    users.push({id,password,upline,isAdmin});
    localStorage.setItem('users', JSON.stringify(users));
    localStorage.setItem('currentUser', JSON.stringify({id,password,upline,isAdmin}));
    alert('ğŸ‰ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!');
    if(isAdmin) window.location.href='admin-dashboard.html';
    else window.location.href='index.html';
  }
});
</script>

</body>
</html>
